<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Riwayat Pencarian - Data Cuaca</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
        <div class="container">
            <a class="navbar-brand fw-bold" href="index.html">Data Cuaca</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="index.html">Beranda</a></li>
                    <li class="nav-item"><a class="nav-link" href="kota-populer.html">Kota Populer</a></li>
                    <li class="nav-item"><a class="nav-link active" aria-current="page" href="riwayat.html">Riwayat</a></li>
                    <li class="nav-item"><a class="nav-link" href="tentang.html">Tentang</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-5">
        <h1 class="text-center mb-4 text-primary">Riwayat Pencarian Cuaca</h1>
        <p class="text-center text-muted">Berikut kota-kota yang pernah Anda cari di halaman Beranda.</p>

        <div id="history-content" class="mt-4"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_KEY = "ddec4165e0ba2c82ad4f4ee850be504f";
        const container = document.getElementById('history-content');

        function loadHistory() {
            let history = [];
            try {
                const saved = localStorage.getItem('weatherHistory');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    if (Array.isArray(parsed)) history = parsed;
                }
            } catch (e) {
                console.warn('Gagal membaca riwayat:', e);
            }

            if (history.length === 0) {
                container.innerHTML = '<div class="alert alert-info text-center">Belum ada riwayat pencarian. Silakan cari kota di halaman Beranda.</div>';
                return;
            }

            const listGroup = document.createElement('div');
            listGroup.className = 'list-group';

            history.forEach((city) => {
                const item = document.createElement('button');
                item.type = 'button';
                item.className = 'list-group-item list-group-item-action d-flex justify-content-between align-items-center';
                item.textContent = city;
                const badge = document.createElement('span');
                badge.className = 'badge bg-primary rounded-pill';
                badge.textContent = 'Lihat Cuaca';
                item.appendChild(badge);
                item.addEventListener('click', () => showCityWeather(city));
                listGroup.appendChild(item);
            });

            container.innerHTML = '';
            container.appendChild(listGroup);

            const resultDiv = document.createElement('div');
            resultDiv.id = 'result';
            resultDiv.className = 'mt-4';
            container.appendChild(resultDiv);
        }

        async function showCityWeather(city) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `<div class="alert alert-info text-center">Memuat cuaca untuk ${city}...</div>`;

            const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${API_KEY}&units=metric&lang=id`;
            try {
                const res = await fetch(url);
                if (!res.ok) {
                    resultDiv.innerHTML = `<div class=\"alert alert-danger text-center\">Gagal memuat data (${res.status})</div>`;
                    return;
                }
                const data = await res.json();
                const temp = Math.round(data.main.temp);
                const desc = data.weather[0].description.toUpperCase();
                resultDiv.innerHTML = `
                    <div class=\"card p-3\">
                        <h4 class=\"mb-1\">${data.name}, ${data.sys.country}</h4>
                        <p class=\"display-5 mb-1\">${temp}&deg;C</p>
                        <p class=\"text-muted mb-2\">${desc}</p>
                        <small>Kelembaban: ${data.main.humidity}% | Angin: ${data.wind.speed} m/s | Tekanan: ${data.main.pressure} hPa</small>
                    </div>`;
            } catch (e) {
                resultDiv.innerHTML = `<div class=\"alert alert-danger text-center\">Terjadi error saat mengambil data.</div>`;
            }
        }

        loadHistory();
    </script>
</body>
</html>
